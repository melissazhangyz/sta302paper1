---
title: "A study of crisis and response in Toronto"
author: Yingzhi Zhang
date: today
date-format: long
abstract: "Quickly reacting to crisis is part of the responsibility of police in Toronto. These years, more and more cases of crisis are observed in the 180 neighbourhood in Toronto. Understanding the trend of different types of crisis and the time they happened provides a better picture of the civil life and happiness level in Toronto. In this study, a variety of tables and charts are makde to illustrate the changing patterns of crisis happened in Toronto."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(janitor)
library(lubridate)
library(ggplot2)
library(palmerpenguins)
```


# Introduction

Toronto Police Service (TPS) contains a large range of service to protect the civilians in the city of Toronto. Among them, Persons in Crisis (PIC) calls for service attended (CFSA) is one of the most emergent situations that requires immediate response. 

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

The data is downloaded and gathered from opendatatoronto.com.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = "none") +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk more about it.

And also planes. (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv("/Users/zhii/Documents/UofT/3rd year/STA302/sta302paper1/outputs/data/crisis_type_data.csv")

analysis_data |> 
  ggplot(aes(x = Year, y = Number)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(x = "Year",
       y = "Number of crisis")
```

Talk way more about it. 





# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: false
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("outputs/models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: false
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: false
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: false
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


